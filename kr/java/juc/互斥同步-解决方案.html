<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>互斥同步-解决方案 | Keep Running</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.png">
    <script charset="utf-8" async="async" src="/js/jquery.min.js"></script>
    <script charset="utf-8" async="async" src="/js/global.js"></script>
    <script charset="utf-8" async="async" src="/js/fingerprint2.min.js"></script>
    <meta name="description" content="">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.42b858ce.css" as="style"><link rel="preload" href="/assets/js/app.cfd60917.js" as="script"><link rel="preload" href="/assets/js/4.8234885e.js" as="script"><link rel="preload" href="/assets/js/3.1429892b.js" as="script"><link rel="preload" href="/assets/js/44.a51272ee.js" as="script"><link rel="prefetch" href="/assets/js/10.0f0de338.js"><link rel="prefetch" href="/assets/js/11.0c47d372.js"><link rel="prefetch" href="/assets/js/12.b45ce082.js"><link rel="prefetch" href="/assets/js/13.f2032214.js"><link rel="prefetch" href="/assets/js/14.0a8927b2.js"><link rel="prefetch" href="/assets/js/15.9ab1d206.js"><link rel="prefetch" href="/assets/js/16.f03f2e40.js"><link rel="prefetch" href="/assets/js/17.c6bbe2be.js"><link rel="prefetch" href="/assets/js/18.e08bb862.js"><link rel="prefetch" href="/assets/js/19.c00af7cb.js"><link rel="prefetch" href="/assets/js/20.35396483.js"><link rel="prefetch" href="/assets/js/21.fe05d239.js"><link rel="prefetch" href="/assets/js/22.80eaa289.js"><link rel="prefetch" href="/assets/js/23.bce5e854.js"><link rel="prefetch" href="/assets/js/24.fa104861.js"><link rel="prefetch" href="/assets/js/25.2c725be9.js"><link rel="prefetch" href="/assets/js/26.fc7addb7.js"><link rel="prefetch" href="/assets/js/27.fc831a66.js"><link rel="prefetch" href="/assets/js/28.3784f580.js"><link rel="prefetch" href="/assets/js/29.7e78aa5c.js"><link rel="prefetch" href="/assets/js/30.b074fddd.js"><link rel="prefetch" href="/assets/js/31.059ebf27.js"><link rel="prefetch" href="/assets/js/32.12570018.js"><link rel="prefetch" href="/assets/js/33.d0dc971f.js"><link rel="prefetch" href="/assets/js/34.c9b46696.js"><link rel="prefetch" href="/assets/js/35.77a81c6a.js"><link rel="prefetch" href="/assets/js/36.6048e328.js"><link rel="prefetch" href="/assets/js/37.b9f285de.js"><link rel="prefetch" href="/assets/js/38.ac5a2abf.js"><link rel="prefetch" href="/assets/js/39.97ca52cb.js"><link rel="prefetch" href="/assets/js/40.1689d33f.js"><link rel="prefetch" href="/assets/js/41.4d2d8182.js"><link rel="prefetch" href="/assets/js/42.8647a8ff.js"><link rel="prefetch" href="/assets/js/43.f867a280.js"><link rel="prefetch" href="/assets/js/45.c31e6474.js"><link rel="prefetch" href="/assets/js/46.fe85ae54.js"><link rel="prefetch" href="/assets/js/47.dc8a97d4.js"><link rel="prefetch" href="/assets/js/48.c97f7726.js"><link rel="prefetch" href="/assets/js/49.ac219d14.js"><link rel="prefetch" href="/assets/js/5.963fada3.js"><link rel="prefetch" href="/assets/js/50.926ecfa5.js"><link rel="prefetch" href="/assets/js/51.e776b5b1.js"><link rel="prefetch" href="/assets/js/52.4938314c.js"><link rel="prefetch" href="/assets/js/53.6b4d7266.js"><link rel="prefetch" href="/assets/js/54.bfaf622b.js"><link rel="prefetch" href="/assets/js/55.c6d160b9.js"><link rel="prefetch" href="/assets/js/56.31f6843c.js"><link rel="prefetch" href="/assets/js/57.55cbf7b8.js"><link rel="prefetch" href="/assets/js/58.8174871d.js"><link rel="prefetch" href="/assets/js/59.3eee2bde.js"><link rel="prefetch" href="/assets/js/6.b2e36a75.js"><link rel="prefetch" href="/assets/js/60.233a32ed.js"><link rel="prefetch" href="/assets/js/61.defb83ac.js"><link rel="prefetch" href="/assets/js/62.442070cd.js"><link rel="prefetch" href="/assets/js/63.cc121456.js"><link rel="prefetch" href="/assets/js/64.c8f83f5d.js"><link rel="prefetch" href="/assets/js/65.b9bc8c1c.js"><link rel="prefetch" href="/assets/js/7.fb6689bf.js"><link rel="prefetch" href="/assets/js/8.e390cc6b.js"><link rel="prefetch" href="/assets/js/9.c03c9dfe.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.db8a86c9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.42b858ce.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Keep Running</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kr/java/jvm/自动内存管理.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/kr/database/database.html" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/kr/spring/MVC-IOC-AOP.html" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/kr/middleware/redis/redis-base.html" class="nav-link">
  Redis/Zookeeper/Kafka
</a></div><div class="nav-item"><a href="/kr/bigdata/hadoop/Hadoop-分布式集群容器部署.html" class="nav-link">
  大数据
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kr/java/jvm/自动内存管理.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/kr/database/database.html" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/kr/spring/MVC-IOC-AOP.html" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/kr/middleware/redis/redis-base.html" class="nav-link">
  Redis/Zookeeper/Kafka
</a></div><div class="nav-item"><a href="/kr/bigdata/hadoop/Hadoop-分布式集群容器部署.html" class="nav-link">
  大数据
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JVM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kr/java/jvm/自动内存管理.html" class="sidebar-link">自动内存管理</a></li><li><a href="/kr/java/jvm/类加载机制.html" class="sidebar-link">类加载机制</a></li><li><a href="/kr/java/jvm/JVM-工具应用.html" class="sidebar-link">JVM 工具应用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JUC</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kr/java/juc/juc.html" class="sidebar-link">JUC</a></li><li><a href="/kr/java/juc/互斥同步-解决方案.html" class="active sidebar-link">互斥同步-解决方案</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>集合</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kr/java/collection/Java-集合.html" class="sidebar-link">Java 集合</a></li><li><a href="/kr/java/collection/常见容错机制.html" class="sidebar-link">常见容错机制</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Other</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kr/java/other/docker-use.html" class="sidebar-link">Docker 使用问题记录</a></li><li><a href="/kr/java/other/Pro-Git-学习总结.html" class="sidebar-link">分布式版本控制系统 Git 学习总结</a></li><li><a href="/kr/java/other/Linux.html" class="sidebar-link">Linux</a></li></ul></section></li></ul> </aside> <div><main class="page"> <div class="theme-default-content content__default"><h1 id="互斥同步-解决方案"><a href="#互斥同步-解决方案" class="header-anchor">#</a> 互斥同步-解决方案</h1> <p><img src="/images/kr/java/juc/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-%E6%A6%82%E5%BF%B5%E4%B8%8E%E9%97%AE%E9%A2%98.png" alt="并发编程-概念与问题"></p> <blockquote><p>同步是一种更为复杂的互斥，而互斥是一种特殊的同步，同步是在互斥基础上实现顺序的访问控制</p></blockquote> <h2 id="互斥锁"><a href="#互斥锁" class="header-anchor">#</a> 互斥锁</h2> <p>互斥锁（<code>Mutex Lock</code>）：采用互斥锁保护临界区，在进入临界区时获取锁<code>lock()</code>，在退出临界区时释放锁<code>unlock()</code></p> <p>当互斥锁加锁失败时，会从用户态切换到内核态，并让内核进行线程上下文切换，简化了锁的使用难度，但存在一定性能开销：</p> <ul><li>加锁失败时，内核将线程从「运行」状态设置为「睡眠」状态，阻塞线程，让出 CPU</li> <li>当锁释放时，之前「睡眠」状态的线程被唤醒会变为「就绪」状态，内核会在合适时间调度 CPU 给该线程运行</li></ul> <blockquote><p>最简单的互斥锁：布尔/二进制互斥锁（独占锁），同一时刻只能有一个进程/线程进入临界区操作临界资源，该过程不可被中断，对临界资源的操作具有原子性</p></blockquote> <h2 id="自旋锁"><a href="#自旋锁" class="header-anchor">#</a> 自旋锁</h2> <p>当一个进程无法请求到资源时，该进程要么忙等待（自旋，占用 CPU 等资源），要么阻塞（让出 CPU 等资源）;</p> <p>互斥锁加锁失败时会进行线程阻塞，由内核完成两次线程上下文切换，当临界区执行时间比较短时或比线程切换的时间开销更短时，进行线程忙等待更好;</p> <p>自旋锁：当互斥锁加锁失败时进行忙等待，占用 CPU 资源，但避免了线程上下文切换的性能开销，周期性检测锁的状态，直到获取锁成功
<img src="/images/kr/java/juc/%E8%87%AA%E6%97%8B%E9%94%81.png" alt="自旋锁"></p> <blockquote><p>自旋锁在单核 CPU 上无法使用，因为自旋的线程永远不会放弃 CPU，除非使用抢占式调度器（即可中断一个线程，运行其他线程）</p></blockquote> <h2 id="信号量"><a href="#信号量" class="header-anchor">#</a> 信号量</h2> <p><img src="/images/kr/java/juc/%E4%BF%A1%E5%8F%B7%E9%87%8F-PV%E6%93%8D%E4%BD%9C.png" alt="信号量-PV操作"></p> <blockquote><p>二进制信号量：取值为 0/1，类似于互斥锁（理解为可用资源量为 1）</p> <p>计数信号量：用于控制具有多个实例的某种资源，初值为资源可用数量，可以理解为多个资源的互斥锁（1 -&gt; N）</p> <p>信号量降级：信号量可用资源为 1 时，信号量降级为互斥锁（其实就是锁的粒度范围扩大了，并发性降低了）</p></blockquote> <p>信号量通过一个同步队列存放所有 P 操作而阻塞的进程，并将进程状态切换到等待状态，等其它进程执行 V 操作后释放资源并唤醒同步队列的阻塞进程，进入就绪状态，等待 CPU 调度</p> <blockquote><p>信号量的正确使用不依赖于信号量同步队列的特定排队策略</p> <p>对同一信号量的原子性保证：没有两个进程可以同时执行 PV 操作，这是一个临界区问题</p> <p>信号量可以用于做流量控制，特别是公用资源有限的应用场景</p></blockquote> <h2 id="管程"><a href="#管程" class="header-anchor">#</a> 管程</h2> <blockquote><p><a href="https://baike.baidu.com/item/%E7%AE%A1%E7%A8%8B/10503922?fr=aladdin" target="_blank" rel="noopener noreferrer">管程-百度百科<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Java 语言在 1.5 之前，提供的唯一并发原语就是管程，而且 1.5 之后提供的 JUC 并发包，也是以管程技术为基础的</p> <p><code>Synchronized</code>和<code>wait()</code>、<code>notify()</code>、<code>notifyAll()</code>这三个方法是 Java 中实现管程技术的组成部分</p> <p>管程和信号量是等价的，即是用管程能够实现信号量，也能用信号量实现管程</p> <p>管程指管理共享变量以及对共享变量操作的过程，让其支持并发。在 Java 领域就是管理类的成员变量和成员方法，让这个类是线程安全的</p> <p>管程有 Hasen 模型、Hoare 模型和 MESA 模型，广泛使用的是 MESA 模型（Java 管程也是基于该模型）</p></blockquote> <p><img src="/images/kr/java/juc/%E7%AE%A1%E7%A8%8B.png" alt="管程"></p><div style="height:320px;"><div style="float:left;width:50%;"><img src="/images/kr/java/juc/%E7%AE%A1%E7%A8%8B%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BB%A3%E7%A0%81%E5%8C%96%E8%AF%AD%E4%B9%89.jpg" alt="管程模型的代码化语义"></div> <div style="float:right;width:50%;"><img src="/images/kr/java/juc/MESA%E7%AE%A1%E7%A8%8B.jpg" alt="MESA管程"></div></div><p></p> <blockquote><p><a href="https://zhuanlan.zhihu.com/p/368008638" target="_blank" rel="noopener noreferrer">参考：管程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>以队列（共享变量）及其对队列的操作：入队和出队为例，入队的条件变量：队列有空，出队的条件变量：队列非空</p> <p>互斥：一次只能有一个线程进入管程通过某个操作方法对共享变量进行操作，达到互斥（即操作方法是互斥的）</p> <p>同步：当线程在调用某个操作方法时，先判断某个条件变量是否满足，若满足则执行方法，
若不满足则通过调用<code>wait()</code>进入条件变量对应的等待队列阻塞等待，此时其余线程可进入管程，
当另一个线程进入管程后使得该条件变量满足了，则通过调用<code>notify()</code>/<code>notifyAll()</code>唤醒通知条件变量对应的等待队列中的线程，重新进入入口等待队列</p></blockquote> <h2 id="对象监视锁-monitor"><a href="#对象监视锁-monitor" class="header-anchor">#</a> 对象监视锁 Monitor</h2> <blockquote><p>Monitor，直译为“监视器”，而操作系统领域一般翻译为“管程”，是管程在 Java 中的实现</p> <p>每个 Java 对象都可关联一个<code>Monitor</code>对象，如果使用<code>Synchronized</code>给该对象加重量级锁，该对象头的<code>Mark Word</code>就被设置指向<code>Monitor</code>对象的指针</p></blockquote> <p><img src="/images/kr/java/juc/%E5%AF%B9%E8%B1%A1%E7%9B%91%E8%A7%86%E9%94%81.png" alt="对象监视锁Monitor"> <img src="/images/kr/java/juc/%E5%AF%B9%E8%B1%A1%E7%9B%91%E8%A7%86%E9%94%81-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.png" alt="对象监视锁-数据结构"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Monitor 是由 ObjectMonitor 实现的，其主要数据结构如下（位于 HotSpot 虚拟机源码 ObjectMonitor.hpp 文件，C++ 实现的）</span>
<span class="token class-name">ObjectMonitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _header       <span class="token operator">=</span> NULL<span class="token punctuation">;</span>
    _count        <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token comment">// 记录个数</span>
    _waiters      <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    _recursions   <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    _object       <span class="token operator">=</span> NULL<span class="token punctuation">;</span>
    _owner        <span class="token operator">=</span> NULL<span class="token punctuation">;</span>   <span class="token comment">// 当前持有该锁的线程</span>
    _WaitSet      <span class="token operator">=</span> NULL<span class="token punctuation">;</span>   <span class="token comment">// 处于 wait 状态（不参与竞争，等待唤醒）的线程，会被加入到该表</span>
    _WaitSetLock  <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    _Responsible  <span class="token operator">=</span> NULL <span class="token punctuation">;</span>
    _succ         <span class="token operator">=</span> NULL <span class="token punctuation">;</span>
    _cxq          <span class="token operator">=</span> NULL <span class="token punctuation">;</span>
    <span class="token class-name">FreeNext</span>      <span class="token operator">=</span> NULL <span class="token punctuation">;</span>
    _EntryList    <span class="token operator">=</span> NULL <span class="token punctuation">;</span>  <span class="token comment">// 处于等待锁状态（参与竞争锁）的线程，会被加入到该表</span>
    _SpinFreq     <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    _SpinClock    <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    <span class="token class-name">OwnerIsThread</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>线程访问同步代码的过程：</p> <ol><li>首先会进入 _EntryList 集合，当线程获取到对象锁 Monitor 后，进入 _Owner 并把 Monitor 中的 owner 变量设置为当前线程，同时 Monitor 中的计数器 count 加 1</li> <li>若线程调用 wait()，将释放当前持有的 Monitor，owner 变量恢复为 null，count 自减 1，同时该线程进入 _WaitSet 集合中等待被唤醒</li> <li>若当前线程执行完毕，也将释放 Monitor 并复位 count 值，以便其他线程进入获取 Monitor</li></ol> <blockquote><p>Thread.sleep()：调用该方法是不会让出监视锁</p> <p>参考：<a href="https://www.icode9.com/content-1-1190242.html" target="_blank" rel="noopener noreferrer">对象锁<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="synchronized"><a href="#synchronized" class="header-anchor">#</a> Synchronized</h2> <blockquote><p>Synchronized 是一种独占锁，是一种悲观锁，是管程在 Java 中内置实现的锁，会导致其它所有需要锁的线程挂起，等待持有锁的线程释放锁，效率不是很高。</p></blockquote> <p><img src="/images/kr/java/juc/synchronized.png" alt="synchronized"></p> <h2 id="wait-notify-等待通知机制"><a href="#wait-notify-等待通知机制" class="header-anchor">#</a> wait/notify 等待通知机制</h2> <p>如果线程调用了<code>Object.wait()</code>，那么该线程会处于该对象的等待池（条件等待队列）中，等待池中的线程不会去竞争该对象的锁，
当有线程调用了<code>Object.notify()</code>/<code>Object.notifyAll()</code>时，被唤醒的的线程会进入该对象的锁池（入口等待队列）中，锁池中的线程会去竞争该对象锁</p> <blockquote><p>wait()/notify() 需在 Synchronized 中调用，否则会抛出 java.lang.IllegalMonitorStateException</p></blockquote> <p><img src="/images/kr/java/juc/wait-notify.png" alt="wait-notify"></p> <h2 id="aqs"><a href="#aqs" class="header-anchor">#</a> AQS</h2> <p>AQS：AbstractQueuedSynchronizer，抽象队列同步器，用来构建锁和同步器的框架</p> <ul><li>Abstract：AQS 是一个抽象类，只实现一些主要的逻辑，有些方法推迟到子类实现</li> <li>Queued：AQS 是用先进先出队列来存储数据的</li> <li>Synchronizer：即 AQS是 实现同步功能的</li></ul> <p><img src="/images/kr/java/juc/AQS.png" alt="AQS"> <img src="/images/kr/java/juc/CLH.png" alt="CLH"></p> <h2 id="condition-条件机制"><a href="#condition-条件机制" class="header-anchor">#</a> Condition 条件机制</h2> <p><img src="/images/kr/java/juc/Condition-%E6%9D%A1%E4%BB%B6%E6%9C%BA%E5%88%B6.png" alt="Condition 条件机制"></p> <h2 id="同步器"><a href="#同步器" class="header-anchor">#</a> 同步器</h2> <p><img src="/images/kr/java/juc/%E5%90%8C%E6%AD%A5%E5%99%A8.png" alt="同步器"></p> <h2 id="lock"><a href="#lock" class="header-anchor">#</a> Lock</h2> <p><img src="/images/kr/java/juc/Lock.png" alt="Lock"></p> <blockquote><p>LockSupport：定义了一组的公共静态方法，提供了最基本的线程阻塞和唤醒功能</p></blockquote> <h2 id="死锁-饥饿"><a href="#死锁-饥饿" class="header-anchor">#</a> 死锁/饥饿</h2> <p>死锁：一组进程内的每个进程都等待一个事件（比如资源的获取和释放），而该事件只可能由组内的另一个进程产生
<img src="/images/kr/java/juc/%E6%AD%BB%E9%94%81.png" alt="死锁">
无限阻塞/饥饿：即进程无限等待信号量，如果对与信号量有关的同步队列按<code>LIFO 后进先出</code>顺序来阻塞和唤醒进程，那么可能发生无限阻塞</p> <h2 id="锁的划分"><a href="#锁的划分" class="header-anchor">#</a> 锁的划分</h2> <ul><li>悲观锁/乐观锁：一种设计思想
<img src="/images/kr/java/juc/%E6%82%B2%E8%A7%82%E9%94%81-%E4%B9%90%E8%A7%82%E9%94%81.png" alt="悲观锁-乐观锁"></li> <li>独占锁/共享锁：独占锁是指该锁一次只能被一个线程所持有，共享锁是指该锁可被多个线程所持有</li> <li>可重入锁/不可重入锁：同一线程是否可重复获取该锁</li> <li>公平锁/非公平锁：多个线程是否按照申请锁的顺序来获取锁</li> <li>分段锁：设计目的是细化锁的粒度，当操作不需要更新整个数组时，就仅仅针对数组中的一项进行加锁操作（如 JDK7 ConcurrentHashMap）</li> <li>偏向锁/轻量级锁/重量级锁：
这三种锁是指锁的状态，并且是针对Synchronized。在Java 5通过引入锁升级的机制来实现高效Synchronized。这三种锁的状态是通过对象监视器在对象头中的字段来表明的。
偏向锁是指一段同步代码一直被一个线程所访问，那么该线程会自动获取锁。降低获取锁的代价。
轻量级锁是指当锁是偏向锁的时候，被另一个线程所访问，偏向锁就会升级为轻量级锁，其他线程会通过自旋的形式尝试获取锁，不会阻塞，提高性能。
重量级锁是指当锁为轻量级锁的时候，另一个线程虽然是自旋，但自旋不会一直持续下去，当自旋一定次数的时候，还没有获取到锁，就会进入阻塞，该锁膨胀为重量级锁。重量级锁会让他申请的线程进入阻塞，性能降低</li> <li>自旋锁：自旋锁是指尝试获取锁的线程不会立即阻塞，而是采用循环的方式去尝试获取锁，这样的好处是减少线程上下文切换的消耗，缺点是循环会消耗CPU</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2022/6/8</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/kr/java/juc/juc.html" class="prev">
          JUC
        </a></span> <span class="next"><a href="/kr/java/collection/Java-集合.html">
          Java 集合
        </a>
        →
      </span></p></div> </main></div> <aside class="page-sidebar"> <div class="page-side-toolbar"><div class="option-box-toc-fixed"><div class="toc-container-sidebar"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:650px"><div style="font-weight:bold;text-align:center;">互斥同步-解决方案</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#互斥锁" class="toc-sidebar-link">互斥锁</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#自旋锁" class="toc-sidebar-link">自旋锁</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#信号量" class="toc-sidebar-link">信号量</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#管程" class="toc-sidebar-link">管程</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#对象监视锁-monitor" class="toc-sidebar-link">对象监视锁 Monitor</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#synchronized" class="toc-sidebar-link">Synchronized</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#wait-notify-等待通知机制" class="toc-sidebar-link">wait/notify 等待通知机制</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#aqs" class="toc-sidebar-link">AQS</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#condition-条件机制" class="toc-sidebar-link">Condition 条件机制</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#同步器" class="toc-sidebar-link">同步器</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#lock" class="toc-sidebar-link">Lock</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#死锁-饥饿" class="toc-sidebar-link">死锁/饥饿</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#锁的划分" class="toc-sidebar-link">锁的划分</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div> <div class="option-box-toc-over"><img src="/images/system/toc.png" class="nozoom"> <span class="show-txt">目录</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:550px"><div style="font-weight:bold;text-align:center;">互斥同步-解决方案</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#互斥锁" class="toc-sidebar-link">互斥锁</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#自旋锁" class="toc-sidebar-link">自旋锁</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#信号量" class="toc-sidebar-link">信号量</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#管程" class="toc-sidebar-link">管程</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#对象监视锁-monitor" class="toc-sidebar-link">对象监视锁 Monitor</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#synchronized" class="toc-sidebar-link">Synchronized</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#wait-notify-等待通知机制" class="toc-sidebar-link">wait/notify 等待通知机制</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#aqs" class="toc-sidebar-link">AQS</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#condition-条件机制" class="toc-sidebar-link">Condition 条件机制</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#同步器" class="toc-sidebar-link">同步器</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#lock" class="toc-sidebar-link">Lock</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#死锁-饥饿" class="toc-sidebar-link">死锁/饥饿</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/kr/java/juc/%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html#锁的划分" class="toc-sidebar-link">锁的划分</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div></div>  </aside></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.cfd60917.js" defer></script><script src="/assets/js/4.8234885e.js" defer></script><script src="/assets/js/3.1429892b.js" defer></script><script src="/assets/js/44.a51272ee.js" defer></script>
  </body>
</html>
