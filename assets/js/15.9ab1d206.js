(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{470:function(s,a,n){"use strict";n.r(a);var t=n(34),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"flume-基本架构及应用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#flume-基本架构及应用场景"}},[s._v("#")]),s._v(" Flume 基本架构及应用场景")]),s._v(" "),n("p",[s._v("Apache Flume 是 Cloudera 提供的一个高可用，高可靠，分布式的海量日志采集系统，能够有效的采集、聚合、传输大量日志数据。Flume 支持在日志系统中定制各类数据发送方，用于收集数据，也提供对数据进行简单处理，并写到各种数据接受方（可定制）的能力，通常用于日志数据的收集，Flume 特性：")]),s._v(" "),n("ul",[n("li",[s._v("提供上下文路由特征")]),s._v(" "),n("li",[s._v("Flume Channel 是基于事务，保证了数据在传送和接收时的一致性")]),s._v(" "),n("li",[s._v("具有简单灵活的基于流的数据流架构")]),s._v(" "),n("li",[s._v("具有负载均衡机制和故障转移机制，具有健壮性和容错性")]),s._v(" "),n("li",[s._v("一个简单可扩展的数据模型(Source、Channel、Sink)，三个组件是可灵活组合的")])]),s._v(" "),n("h2",{attrs:{id:"架构和原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#架构和原理"}},[s._v("#")]),s._v(" 架构和原理")]),s._v(" "),n("h3",{attrs:{id:"基本架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本架构"}},[s._v("#")]),s._v(" 基本架构")]),s._v(" "),n("p",[n("img",{attrs:{src:"/images/kr/bigdata/flume/flume-architecture.jpg",alt:""}}),s._v("\n外部数据源以特定格式向 Flume 发送 Event (事件)，当 Source 接收到 Event 时，将其存储到一个或多个 Channel，Channe 会一直保存 Event 直到它被 Sink 所消费。")]),s._v(" "),n("ul",[n("li",[s._v("Agent：一个独立 JVM 进程（Flume 代理，提供持续传输数据服务），包含 Source、 Channel、 Sink 等组件")]),s._v(" "),n("li",[s._v("Event：Flume NG 数据传输的基本单元，也是事务的基本单位，由 Header 和 Body 组成：\n"),n("ul",[n("li",[s._v("Header：为键-值映射，用来存储 Event 一些属性信息")]),s._v(" "),n("li",[s._v("Body：为字节数组，存放采集的具体原始数据")])])]),s._v(" "),n("li",[s._v("Source：数据采集组件，从外部数据源采集数据并存储到 Channel，可处理各种类型/格式的数据")]),s._v(" "),n("li",[s._v("Channel：是 Source/Sink 之间的管道（缓冲区），允许 Source/Sink 运作在不同的速率上；Channel 是线程安全的，可同时处理多个 Source 的写入操作和多个 Sink 的读取操作。用于临时存储数据，可以是内存或持久化文件系统：\n"),n("ul",[n("li",[s._v("Memory Channel：内存中的队列，优点是速度快，但数据可能会丢失")]),s._v(" "),n("li",[s._v("File Channel：持久化文件系统，优点是能保证数据不丢失，但是速度慢")])])]),s._v(" "),n("li",[s._v("Sink：主要功能是从 Channel 中轮询读取 Event，并存入外部存储系统或转发到下一个 Source，成功后再从 Channel 中移除 Event")])]),s._v(" "),n("h3",{attrs:{id:"组件类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#组件类型"}},[s._v("#")]),s._v(" 组件类型")]),s._v(" "),n("p",[s._v("Flume 中的每一个组件都提供了丰富的类型，适用于不同场景：\nSource：")]),s._v(" "),n("ul",[n("li",[s._v("Avro Source：监听网络端口并采集 Avro 序列化的端口数据")]),s._v(" "),n("li",[s._v("Thrift Source：监听 Thrift 端口并从外部 Thrift 客户端流接收数据")]),s._v(" "),n("li",[s._v("Exec Source：启动指定的 Shell 命令并采集该命令下的输出")]),s._v(" "),n("li",[s._v("SpoolDir Source：监控指定文件夹并采集该文件夹中新文件的数据，（注：文件不可变）")]),s._v(" "),n("li",[s._v("Taildir Source：监控指定目录下多个文件，采集多个文件中追加的数据")]),s._v(" "),n("li",[s._v("Kafka Source：使用 kafka consumer 原理采集 kafka 中的数据")]),s._v(" "),n("li",[s._v("NetCat Source：启动 Socket 服务监听端口，并采集端口数据")])]),s._v(" "),n("p",[s._v("Channel：")]),s._v(" "),n("ul",[n("li",[s._v("Memory Channel：Event 存储在内存中，读写速度快，但数据易丢失")]),s._v(" "),n("li",[s._v("Jdbc Channel：Event 被持久化到数据库中，目前支持 Derby，适用于可恢复的场景")]),s._v(" "),n("li",[s._v("Kafka Channel：Agent 使用 Kafka 作为 Channel 的数据缓存")]),s._v(" "),n("li",[s._v("File Channel：Event 被缓存在本地磁盘文件中，可靠性高，不会丢失，但可能会重复数据")]),s._v(" "),n("li",[s._v("Spillable Memory Channel：Event 存储在内存和磁盘中，内存充当主存储，磁盘充当溢出")])]),s._v(" "),n("p",[s._v("Sink：")]),s._v(" "),n("ul",[n("li",[s._v("HDFS Sink：数据写入 HDFS，支持 text/sequence 文件且支持压缩，支持多种写入策略")]),s._v(" "),n("li",[s._v("Hive Sink：将 Event 以 text/json 数据格式直接存储到 Hive 分区表")]),s._v(" "),n("li",[s._v("Logger Sink：数据输出到日志中，通常用于 debug")]),s._v(" "),n("li",[s._v("Avro Sink：Avro Sink 可向 Avro Source 发送 Avro 序列化数据，实现 Agent 之间的级联")]),s._v(" "),n("li",[s._v("Thrift Sink：同avro sink")]),s._v(" "),n("li",[s._v("File Roll Sink：数据存储到本地文件系统")]),s._v(" "),n("li",[s._v("Null Sink：直接丢弃")]),s._v(" "),n("li",[s._v("HBase Sink：数据存储到 HBase 中")]),s._v(" "),n("li",[s._v("ElasticSearch Sink：直接存储到 ES 中")]),s._v(" "),n("li",[s._v("Kafka Sink：将数据存储到 Kafka 中")]),s._v(" "),n("li",[s._v("HTTP Sink：将接收到的数据通过 Post 请求发送到远程服务，Event 内容作为请求体发送")])]),s._v(" "),n("h2",{attrs:{id:"flume-架构模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#flume-架构模式"}},[s._v("#")]),s._v(" Flume 架构模式")]),s._v(" "),n("h3",{attrs:{id:"简单串联"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简单串联"}},[s._v("#")]),s._v(" 简单串联")]),s._v(" "),n("p",[n("img",{attrs:{src:"/images/kr/bigdata/flume/%E7%AE%80%E5%8D%95%E4%B8%B2%E8%81%94.png",alt:""}})]),s._v(" "),n("p",[s._v("Flume 支持跨越多个 Agent 的数据传递，这要求前一个 Agent 的 Sink 和下一个 Agent 的 Source 都必须是 Avro 类型，Sink 指向 Source 所在主机名 (或 IP 地址) 和端口；此模式不建议桥接过多的 Flume 数量，Flume 数量过多不仅会影响传输速率，而且一旦传输过程中某个节点 Flume 宕机，会影响整个传输系统")]),s._v(" "),n("h3",{attrs:{id:"聚合"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#聚合"}},[s._v("#")]),s._v(" 聚合")]),s._v(" "),n("p",[n("img",{attrs:{src:"/images/kr/bigdata/flume/%E8%81%9A%E5%90%88.png",alt:""}})]),s._v(" "),n("p",[s._v("日志收集中常常存在大量的客户端（比如分布式 web 服务），Flume 支持使用多个 Agent 分别收集日志，然后通过一个或者多个 Agent 聚合后再存储到文件系统中")]),s._v(" "),n("h3",{attrs:{id:"复制和多路复用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#复制和多路复用"}},[s._v("#")]),s._v(" 复制和多路复用")]),s._v(" "),n("p",[n("img",{attrs:{src:"/images/kr/bigdata/flume/%E5%A4%8D%E5%88%B6%E5%92%8C%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8.png",alt:""}})]),s._v(" "),n("p",[s._v("Flume 支持从一个 Source 向多个 Channel，也就是向多个 Sink 传递事件，这个操作称之为 Fan Out(扇出)。默认情况下 Fan Out 是向所有的 Channel 复制 Event，即所有 Channel 收到的数据都是相同的。同时 Flume 也支持在 Source 上自定义一个复用选择器 (multiplexing selector) 来实现自定义的路由规则")]),s._v(" "),n("h3",{attrs:{id:"负载均衡和故障转移"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡和故障转移"}},[s._v("#")]),s._v(" 负载均衡和故障转移")]),s._v(" "),n("p",[n("img",{attrs:{src:"/images/kr/bigdata/flume/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%92%8C%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB.png",alt:""}})]),s._v(" "),n("p",[s._v("Flume 支持使用将多个 Sink 逻辑上分到一个 Sink 组，Sink 组配合不同的 SinkProcessor 可以实现负载均衡和故障转移的功能")]),s._v(" "),n("h2",{attrs:{id:"flume-事务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#flume-事务"}},[s._v("#")]),s._v(" Flume 事务")]),s._v(" "),n("p",[n("img",{attrs:{src:"/images/kr/bigdata/flume/Flume-%E4%BA%8B%E5%8A%A1.png",alt:""}})]),s._v(" "),n("p",[s._v("Channel 使用被动存储机制，依靠 Source 完成数据写入（推送），Sink 完成数据读取（拉取）：\nChannel 是先进先出的 Event 队列，Source 到 Channel 是事务性的，Channel 到 Sink 也是完全事务性的，每个 Sink 用 Channel 启用一个事务，批量 Event 一旦成功写到存储系统或下一个 Agent，Sink 就用 Channel 提交事务，事务一旦提交，该 Channel 从自己内部缓冲区删除 Event\nFlume 推送事务流程")]),s._v(" "),n("ul",[n("li",[s._v("doPut：将批数据先写入临时缓冲区 putList，不是来一条 Event 就处理，是来一批 Event 才处理")]),s._v(" "),n("li",[s._v("doCommit：检查 Channel 内存队列空间是否充足，充足则直接写入 Channel 内存队列")]),s._v(" "),n("li",[s._v("doRollback：Channel 内存队列空间不足，则回滚数据到 putList，等待重新传递")])]),s._v(" "),n("p",[s._v("Flume 拉取事务流程")]),s._v(" "),n("ul",[n("li",[s._v("doTake：先将数据取到临时缓冲区 takeList，并将数据发送到 HDFS")]),s._v(" "),n("li",[s._v("doCommit：如果数据全部发送成功，则清除临时缓冲区 takeList")]),s._v(" "),n("li",[s._v("doRollback：数据发送过程中如果出现异常，将临时缓冲区 takeList 中的数据回滚到 Channel 内存队列，等待重新传递")])]),s._v(" "),n("h2",{attrs:{id:"flume-agent-内部原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#flume-agent-内部原理"}},[s._v("#")]),s._v(" Flume Agent 内部原理")]),s._v(" "),n("p",[n("img",{attrs:{src:"/images/kr/bigdata/flume/Agent-%E5%8E%9F%E7%90%86.png",alt:""}})]),s._v(" "),n("ul",[n("li",[s._v("Source Interceptors：Source 可以指定多个拦截器按先后顺序依次对采集到的数据进行处理")]),s._v(" "),n("li",[s._v("Channel Selectors：Source 发送数据到具体 Channel 的选择策略")]),s._v(" "),n("li",[s._v("Sink Processors：从 Channel 获取数据的具体 Sink 的选择策略")])]),s._v(" "),n("p",[s._v("Source Interceptors：")]),s._v(" "),n("ul",[n("li",[s._v("Timestamp Interceptor：向 Event 中 Header 添加 Timestamp 时间戳信息")]),s._v(" "),n("li",[s._v("Host Interceptor：向 Event 中 Header 添加 Host 属性")]),s._v(" "),n("li",[s._v("Search and Replace Interceptor：根据指定规则替换 Event 中 Body 数据")]),s._v(" "),n("li",[s._v("Static Interceptor：向 Event 中 Header 添加固定 key/value")]),s._v(" "),n("li",[s._v("Regex Extractor Interceptor：根据指定规则从 Event 中 Body 抽取数据，生成 key/value，再把 key/value 添加到 Header 中")])]),s._v(" "),n("p",[s._v("Channel Selectors：")]),s._v(" "),n("ul",[n("li",[s._v("Replicating Selector：复制选择器，默认，将 Event 复制发送到所有 Channel")]),s._v(" "),n("li",[s._v("Multiplexing Selector：多路复用选择器，根据 Event 中 Header 将 Event 发送到不同 Channel")])]),s._v(" "),n("p",[s._v("Sink Processors：")]),s._v(" "),n("ul",[n("li",[s._v("Default Processor：默认，不用配置 Sink Group，一个 Channel 接一个 Sink 形式")]),s._v(" "),n("li",[s._v("Load balancing Processor：负载均衡处理器，一个 Channle 接多个 Sink(Sink Group)，根据指定的算法进行轮询或随机发送，减轻单个 Sink 压力")]),s._v(" "),n("li",[s._v("Failover Processor：故障转移处理器，一个 Channle 接一个 Sink Group，按照 Sink 优先级，默认先让优先级高的 Sink 来处理数据，而低优先级的 Sink 处于等待状态；若发生故障，则由下易优先级的 Sink 处理")])]),s._v(" "),n("h2",{attrs:{id:"flume-配置及启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#flume-配置及启动"}},[s._v("#")]),s._v(" Flume 配置及启动")]),s._v(" "),n("div",{staticClass:"language-xml template.conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[s._v("# 代理及其上组件命名\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("AgentName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(".sources = "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("SourceName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("AgentName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(".sinks = "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("SinkName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("AgentName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(".channels = "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ChannelName1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ChannelName2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" ...\n# 将 Source/Sink 绑定到 Channel\n# 一个 Source 可以配置多个 Channel，但一个 Sink 只能配置一个 Channel\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("AgentName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(".sources."),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("SourceName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(".channels = "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ChannelName1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ChannelName2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" ...\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("AgentName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(".sinks."),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("SinkName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(".channel = "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ChannelName1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n# 组件属性设置\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("AgentName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(".sources."),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("SourceName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("."),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("someProperty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" = "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("someValue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("AgentName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(".channels."),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ChannelName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("."),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("someProperty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" = "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("someValue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("AgentName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(".sinks."),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("SinkName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("."),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("someProperty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" = "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("someValue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启 Agent 代理，nohup Command &：将 Agent 置为后台服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --name：Agent name")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --conf：flume 安装路径 conf 目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --conf-file：Agent 配置文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -Dflume.root.logger=INFO,console：-D：动态修改 flume.root.logger 属性值，并将控制台日志级别设置为 INFO")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" flume-ng agent --name agent_name --conf "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLUME_HOME")]),s._v("/conf/ --conf-file template.conf \n    -Dflume.root.logger"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" agent_name.log "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" flume-ng agent -n agent_name -c "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLUME_HOME")]),s._v("/conf/ --f template.conf \n    -Dflume.root.logger"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" agent_name.log "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"flume-镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#flume-镜像"}},[s._v("#")]),s._v(" Flume 镜像")]),s._v(" "),n("div",{staticClass:"language-bash Dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("FROM xzx/jdk-1.8\nRUN yum -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载 Flume 并解压")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -nv : wget 关闭详尽输出，但不进入安静模式")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不单独将 wget 当一行命令，因为下载下来的文件在容器中消失")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# > /dev/null : 丢弃日志输出")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -nv https://mirrors.bfsu.edu.cn/apache/flume/1.9.0/apache-flume-1.9.0-bin.tar.gz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf apache-flume-1.9.0-bin.tar.gz -C /usr/local "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" apache-flume-1.9.0-bin.tar.gz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /usr/local/apache-flume-1.9.0-bin /usr/local/apache-flume-1.9.0\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置环境变量")]),s._v("\nENV FLUME_HOME /usr/local/apache-flume-1.9.0\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将环境变量添加到系统变量中")]),s._v("\nENV "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLUME_HOME")]),s._v("/bin:"),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLUME_HOME")]),s._v("/conf/flume-env.sh.template "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLUME_HOME")]),s._v("/conf/flume-env.sh\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入 hadoop 依赖包")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -nv https://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-3.2.2/hadoop-3.2.2.tar.gz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf hadoop-3.2.2.tar.gz -C /usr/local "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /usr/local/hadoop-3.2.2/share/hadoop/common/*.jar "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLUME_HOME")]),s._v("/lib "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /usr/local/hadoop-3.2.2/share/hadoop/common/lib/*.jar "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLUME_HOME")]),s._v("/lib "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /usr/local/hadoop-3.2.2/share/hadoop/hdfs/hadoop-hdfs-*.jar "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLUME_HOME")]),s._v("/lib "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" hadoop-3.2.2.tar.gz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /usr/local/hadoop-3.2.2\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解决包冲突：flume 的为低版本，删掉即可")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLUME_HOME")]),s._v("/lib/guava-11.0.2.jar\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("h2",{attrs:{id:"flume-案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#flume-案例"}},[s._v("#")]),s._v(" Flume 案例")]),s._v(" "),n("h3",{attrs:{id:"案例一-监控本机端口数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例一-监控本机端口数据"}},[s._v("#")]),s._v(" 案例一：监控本机端口数据")]),s._v(" "),n("p",[s._v("使用 Flume 监听本机一个端口，收集该端口数据，并打印到控制台")]),s._v(" "),n("div",{staticClass:"language-bash flume-netcat-logger.conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听本机端口数据")]),s._v("\nfnl.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fnl_r\nfnl.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fnl_k\nfnl.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fnl_c\nfnl.sources.fnl_r.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" netcat                 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入类型为 netcat 端口类型")]),s._v("\nfnl.sources.fnl_r.bind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xzx-flume              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听本机")]),s._v("\nfnl.sources.fnl_r.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听端口")]),s._v("\nfnl.sinks.fnl_k.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出目的地：控制台")]),s._v("\nfnl.channels.fnl_c.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# channel 类型为内存")]),s._v("\nfnl.channels.fnl_c.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# channel 总量 1000 个事件")]),s._v("\nfnl.channels.fnl_c.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# channel 采集了 100 个事件再提交事务")]),s._v("\nfnl.sources.fnl_r.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fnl_c\nfnl.sinks.fnl_k.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fnl_c\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先启动 flume agent 监听本机端口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" flume-ng agent --name fnl --conf "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLUME_HOME")]),s._v("/conf/ --conf-file flume-netcat-logger.conf -Dflume.root.logger"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" logs/fnl.log "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 netcat 工具发送数据至本机端口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" xzx-flume "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("444444")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"案例二-实时监控单个追加文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例二-实时监控单个追加文件"}},[s._v("#")]),s._v(" 案例二：实时监控单个追加文件")]),s._v(" "),n("p",[s._v("实时监控 Hive 日志，并上传到 HDFS 中")]),s._v(" "),n("div",{staticClass:"language-bash flume-file-hdfs.conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 实时监控单个追加文件")]),s._v("\nffh.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffh_r\nffh.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffh_k\nffh.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffh_c\nffh.sources.ffh_r.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exec 可执行命令")]),s._v("\nffh.sources.ffh_r.command "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -F hive.log\nffh.sources.ffh_r.shell "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /bin/bash -c          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行 shell 脚本的绝对路径")]),s._v("\nffh.sinks.ffh_k.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\nffh.sinks.ffh_k.hdfs.path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs://xzx-hadoop-master:9000/flume/%Y%m%d/%H\nffh.sinks.ffh_k.hdfs.filePrefix "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logs-         "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上传文件的前缀")]),s._v("\nffh.sinks.ffh_k.hdfs.round "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否按照时间滚动文件夹")]),s._v("\nffh.sinks.ffh_k.hdfs.roundValue "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("             "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多少时间单位创建一个新文件夹")]),s._v("\nffh.sinks.ffh_k.hdfs.roundUnit "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hour           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义时间单位")]),s._v("\nffh.sinks.ffh_k.hdfs.useLocalTimeStamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否使用本地时间戳")]),s._v("\nffh.sinks.ffh_k.hdfs.batchSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多少个 Event 才 flush 到 HDFS 一次")]),s._v("\nffh.sinks.ffh_k.hdfs.fileType "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置文件类型，可支持压缩")]),s._v("\nffh.sinks.ffh_k.hdfs.codeC "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lzop               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 支持压缩方式")]),s._v("\nffh.sinks.ffh_k.hdfs.rollInterval "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多久生成一个新的文件")]),s._v("\nffh.sinks.ffh_k.hdfs.roolSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("134217700")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置每个文件的滚动大小，128M")]),s._v("\nffh.sinks.ffh_k.hdfs.rollCount "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件的滚动与 Event 数量无关")]),s._v("\nffh.channels.ffh_c.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\nffh.channels.ffh_c.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nffh.channels.ffh_c.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nffh.sources.ffh_r.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffh_c\nffh.sinks.ffh_k.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffh_c\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HDFS Sink 采用 lzo 压缩时，需要 hadoop 配置 lzo 支持，并建立以下软连接，以便找到压缩相关类")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/hadoop-3.1.3/etc/hadoop/core-site.xml /usr/local/flume-1.9.0/conf/core-site.xml\nlrwxrwxrwx. "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" Sep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" 08:45 core-site.xml -"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /usr/local/hadoop-3.1.3/etc/hadoop/core-site.xml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"案例三-实时监控目录下多个新文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例三-实时监控目录下多个新文件"}},[s._v("#")]),s._v(" 案例三：实时监控目录下多个新文件")]),s._v(" "),n("p",[s._v("使用 Flume 监听整个目录的文件，并上传至 HDFS")]),s._v(" "),n("div",{staticClass:"language-bash flume-dir-hdfs.conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 实时监控目录下单个新文件，不要在监控目录中创建并持续修改文件，被监控文件夹每500 毫秒扫描一次文件")]),s._v("\nfdh.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fdh_r\nfdh.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fdh_k\nfdh.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fdh_c\nfdh.sources.fdh_r.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" spooldir                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 目录类型")]),s._v("\nfdh.sources.fdh_r.spooldir "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /flume/upload          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监控目录")]),s._v("\nfdh.sources.fdh_r.fileSuffix "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" .COMPLETED           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件上传完后的文件后缀")]),s._v("\nfdh.sources.fdh_r.fileHeader "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("                 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否有文件头")]),s._v("\nfdh.sources.fdh_r.ignorePattern "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("^ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("*"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".tmp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 忽略所有 .tmp 后缀的文件，不上传")]),s._v("\nfdh.sinks.fdh_k.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\nfdh.sinks.fdh_k.hdfs.path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs://xzx-hadoop-master:9000/flume/upload/%Y%m%d/%H\nfdh.sinks.fdh_k.hdfs.filePrefix "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" upload-           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上传文件到 HDFS 的前缀")]),s._v("\nfdh.sinks.fdh_k.hdfs.round "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否按时间滚动文件")]),s._v("\nfdh.sinks.fdh_k.hdfs.roundValue "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多少时间单位创建一个新文件夹")]),s._v("\nfdh.sinks.fdh_k.hdfs.roundUnit "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hour               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 时间单位")]),s._v("\nfdh.sinks.fdh_k.hdfs.useLocalTimeStamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否使用本地时间戳")]),s._v("\nfdh.sinks.fdh_k.hdfs.batchSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多少个 Event 才 flush 到 HDFS 一次")]),s._v("\nfdh.sinks.fdh_k.hdfs.fileType "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置文件类型，可支持压缩")]),s._v("\nfdh.sinks.fdh_k.hdfs.rollInterval "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多久生成新文件")]),s._v("\nfdh.sinks.fdh_k.hdfs.rollSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("134217700")]),s._v("           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置每个文件的滚动大小，128M")]),s._v("\nfdh.sinks.fds_k.hdfs.rollCount "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件的滚动与 Event 数量无关")]),s._v("\nfdh.channels.fdh_c.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\nfdh.channels.fdh_c.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nfdh.channels.fdh_c.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nfdh.sources.fdh_r.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fdh_c\nfdh.sinks.fdh_k.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fdh_c\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("h3",{attrs:{id:"案例四-实时监控目录下的多个追加文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例四-实时监控目录下的多个追加文件"}},[s._v("#")]),s._v(" 案例四：实时监控目录下的多个追加文件")]),s._v(" "),n("ul",[n("li",[s._v("Exec source：适用于监控一个实时追加的文件，但不能保证数据不丢失")]),s._v(" "),n("li",[s._v("Spooldir Source：能够保证数据不丢失，且能够实现断点续传，但延迟较高，不能实时监控")]),s._v(" "),n("li",[s._v("Taildir Source 既能够实现断点续传，又可以保证数据不丢失，还能够进行实时监控")])]),s._v(" "),n("p",[s._v("使用 Flume 监听整个目录的实时追加文件，并上传至 HDFS")]),s._v(" "),n("div",{staticClass:"language-bash flume-taildir-hdfs.conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 实时监控目录下的多个追加文件")]),s._v("\nfth.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fth_r\nfth.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fth_k\nfth.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fth_c\nfth.sources.fth_r.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" TAILDIR\nfth.sources.fth_r.positionFile "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /flume/upload/tail_dir.json\nfth.sources.fth_r.filegroups "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fl\nfth.sources.fth_r.filegroups.fl "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/module/flume/files/file.*\nfth.sinks.fth_k.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\nfth.sinks.fth_k.hdfs.path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs://xzx-hadoop-master:9000/flume/upload/%Y%m%d/%H\nfth.sinks.fth_k.hdfs.filePrefix "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" upload-\nfth.sinks.fth_k.hdfs.round "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nfth.sinks.fth_k.hdfs.roundValue "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nfth.sinks.fth_k.hdfs.roundUnit "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hour\nfth.sinks.fth_k.hdfs.useLocalTimeStamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nfth.sinks.fth_k.hdfs.batchSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nfth.sinks.fth_k.hdfs.fileType "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream\nfth.sinks.fth_k.hdfs.rollInterval "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\nfth.sinks.fth_k.hdfs.rollSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("134217700")]),s._v("\nfth.sinks.fts_k.hdfs.rollCount "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nfth.channels.fth_c.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\nfth.channels.fth_c.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nfth.channels.fth_c.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nfth.sources.fth_r.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fth_c\nfth.sinks.fth_k.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fth_c\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[s._v("Taildir 说明：\nTaildir Source 维护了一个 json 格式的 position File，其会定期的往 position File 中更新每个文件读取到的最新的位置，因此能够实现断点续传。\nPosition File 的格式如下：")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"inode"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2496272")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"pos"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"file"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/module/flume/files/file1.txt"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"inode"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2496275")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"pos"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"file"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/module/flume/files/file2.txt"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("blockquote",[n("p",[s._v("Linux 中储存文件元数据的区域叫 inode，每个 inode 都有一个号码，操作系统用 inode 号码来识别不同的文件，Unix/Linux 系统内部不使用文件名，而使用 inode 号码来识别文件")])]),s._v(" "),n("h3",{attrs:{id:"案例五-复制和多路复用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例五-复制和多路复用"}},[s._v("#")]),s._v(" 案例五：复制和多路复用")]),s._v(" "),n("p",[s._v("使用 Flume-1 监控文件变动，Flume-1 将变动内容传递给 Flume-2，Flume-2 负责存储到 HDFS；同时 Flume-1 将变动内容传递给 Flume-3，Flume-3 负责输出到 Local FileSystem")]),s._v(" "),n("div",{staticClass:"language-bash flume-file-flume.conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制和多路复用")]),s._v("\nfff.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fff_r\nfff.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fff_k1 fff_k2\nfff.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fff_c1 fff_c2\nfff.sources.fff_r.selector.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" replicating           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将数据流复制给所有 Channel")]),s._v("\nfff.sources.fff_r.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\nfff.sources.fff_r.command "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -F hive.log\nfff.sources.fff_r.shell "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /bin/bash -c\nfff.sinks.fff_k1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro                            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sink 端的 avro 是一个数据发送者")]),s._v("\nfff.sinks.fff_k1.hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xzx-flume\nfff.sinks.fff_k1.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4141")]),s._v("\nfff.sinks.fff_k2.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\nfff.sinks.fff_k2.hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xzx-flume\nfff.sinks.fff_k2.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4142")]),s._v("\nfff.channels.fff_c1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\nfff.channels.fff_c1.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nfff.channels.fff_c1.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nfff.channels.fff_c2.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\nfff.channels.fff_c2.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nfff.channels.fff_c2.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nfff.sources.fff_r.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fff_c1 fff_c2\nfff.sinks.fff_k1.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fff_c1\nfff.sinks.fff_k2.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fff_c2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("div",{staticClass:"language-bash flume-flume-hdfs.conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ffh.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffh_r\nffh.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffh_k\nffh.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffh_c\nffh.sources.ffh_r.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# source 端的 avro 是一个数据接收服务")]),s._v("\nffh.sources.ffh_r.bind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xzx-flume\nffh.sources.ffh_r.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4141")]),s._v("\nffh.sinks.ffh_k.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\nffh.sinks.ffh_k.hdfs.path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs://xzx-hadoop-master:9000/flume/%Y%m%d/%H\nffh.sinks.ffh_k.hdfs.filePrefix "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" flume-\nffh.sinks.ffh_k.hdfs.round "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nffh.sinks.ffh_k.hdfs.roundValue "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nffh.sinks.ffh_k.hdfs.roundUnit "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hour\nffh.sinks.ffh_k.hdfs.useLocalTimeStamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nffh.sinks.ffh_k.hdfs.batchSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nffh.sinks.ffh_k.hdfs.fileType "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream\nffh.sinks.ffh_k.hdfs.rollInterval "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("\nffh.sinks.ffh_k.hdfs.roolSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("134217700")]),s._v("\nffh.sinks.ffh_k.hdfs.rollCount "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nffh.channels.ffh_c.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\nffh.channels.ffh_c.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nffh.channels.ffh_c.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nffh.sources.ffh_r.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffh_c\nffh.sinks.ffh_k.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffh_c\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("div",{staticClass:"language-bash flume-flume-dir.conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ffd.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffd_r\nffd.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffd_k\nffd.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffd_c\nffd.sources.ffd_r.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\nffd.sources.ffd_r.bind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xzx-flume\nffd.sources.ffd_r.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4142")]),s._v("\nffd.sinks.ffd_k.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" file_roll\nffd.sinks.ffd_k.directory "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /flume          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本地已经存在的目录，不存在也不会自动创建")]),s._v("\nffd.channels.ffd_c.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\nffd.channels.ffd_c.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nffd.channels.ffd_c.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nffd.sources.ffd_r.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffd_c\nffd.sinks.ffd_k.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffd_c\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h3",{attrs:{id:"案例六-负载均衡和故障转移"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例六-负载均衡和故障转移"}},[s._v("#")]),s._v(" 案例六：负载均衡和故障转移")]),s._v(" "),n("p",[s._v("使用 Flume 监控一个端口，其 Sink 组中的 Sink 分别对接 Flume2 和 Flume3，采用 FailoverSinkProcessor 实现故障转移的功能")]),s._v(" "),n("div",{staticClass:"language-bash flume-netcat-flume.conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("fnf.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fnf_r\nfnf.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fnf_c\nfnf.sinkgroups "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fnf_g\nfnf.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fnf_k1 fnf_k2\nfnf.sources.fnf_r.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" netcat\nfnf.sources.fnf_r.bind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xzx-flume\nfnf.sources.fnf_r.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\nfnf.sinkgroups.fnf_g.processor.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" failover\nfnf.sinkgroups.fnf_g.processor.priority.fnf_k1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\nfnf.sinkgroups.fnf_g.processor.priority.fnf_k2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nfnf.sinkgroups.fnf_g.processor.maxpenalty "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\nfnf.sinks.fnf_k1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\nfnf.sinks.fnf_k1.hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xzx-flume\nfnf.sinks.fnf_k1.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4141")]),s._v("\nfnf.sinks.fnf_k2.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\nfnf.sinks.fnf_k2.hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xzx-flume\nfnf.sinks.fnf_k2.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4142")]),s._v("\nfnf.channels.fnf_c.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\nfnf.channels.fnf_c.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nfnf.channels.fnf_c.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nfnf.sources.fnf_r.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fnf_c\nfnf.sinkgroups.fnf_g.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fnf_k1 fnf_k2\nfnf.sinks.fnf_k1.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fnf_c\nfnf.sinks.fnf_k2.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fnf_c\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("div",{staticClass:"language-bash flume-flume-console1.conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ffc1.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffc1_r\nffc1.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffc1_k\nffc1.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffc1_c\nffc1.sources.ffc1_r.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\nffc1.sources.ffc1_r.bind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xzx-flume\nffc1.sources.ffc1_r.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4141")]),s._v("\nffc1.sinks.ffc1_k.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\nffc1.channels.ffc1_c.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\nffc1.channels.ffc1_c.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nffc1.channels.ffc1_c.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nffc1.sources.ffc1_r.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffc1_c\nffc1.sinks.ffc1_k.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffc1_c\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("div",{staticClass:"language-bash flume-flume-console2.conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ffc2.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffc2_r\nffc2.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffc2_k\nffc2.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffc2_c\nffc2.sources.ffc2_r.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\nffc2.sources.ffc2_r.bind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xzx-flume\nffc2.sources.ffc2_r.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4142")]),s._v("\nffc2.sinks.ffc2_k.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\nffc2.channels.ffc2_c.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\nffc2.channels.ffc2_c.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nffc2.channels.ffc2_c.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nffc2.sources.ffc2_r.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffc2_c\nffc2.sinks.ffc2_k.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ffc2_c\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h2",{attrs:{id:"整合-kafka"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#整合-kafka"}},[s._v("#")]),s._v(" 整合 Kafka")]),s._v(" "),n("p",[s._v("以实时流处理项目（如电商平台）为例，由于采集数据量可能存在峰值和峰谷，如果直接将 Flume 聚合后数据输入到 Storm 等分布式计算框架中，可能会超过集群处理能力，通过采用 Kafka 起到削峰作用。\n"),n("img",{attrs:{src:"/images/kr/bigdata/flume/flume-kafka.png",alt:""}}),s._v("\nFlume 发送数据到 Kafka 上主要是通过 KafkaSink 来实现：")]),s._v(" "),n("div",{staticClass:"language-bash exec-memory-kafka.properties line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听 kafka.log 文件，当文件内容有变化时，将新增加的内容发送到 Kafka 的 flume-kafka 主题上")]),s._v("\na1.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s1\na1.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1                                                                                        \na1.sources.s1.type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exec\na1.sources.s1.command"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tail -F /tmp/kafka.log\na1.sources.s1.channels"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("c1 \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置 Kafka 接收器")]),s._v("\na1.sinks.k1.type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" org.apache.flume.sink.kafka.KafkaSink\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置 Kafka 地址")]),s._v("\na1.sinks.k1.brokerList"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xzx:9092\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置发送到 Kafka 上的主题")]),s._v("\na1.sinks.k1.topic"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("flume-kafka\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置序列化方式")]),s._v("\na1.sinks.k1.serializer.class"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kafka.serializer.StringEncoder\na1.sinks.k1.channel"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("c1     \n\na1.channels.c1.type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("memory\na1.channels.c1.capacity"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\na1.channels.c1.transactionCapacity"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("   \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h2",{attrs:{id:"flume-优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#flume-优化"}},[s._v("#")]),s._v(" Flume 优化")]),s._v(" "),n("h3",{attrs:{id:"flume-进程内存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#flume-进程内存"}},[s._v("#")]),s._v(" Flume 进程内存")]),s._v(" "),n("p",[s._v("Flume 进程内存根据 Agent 读取的数据量大小及速度决定，一般建议内存设置为 1G~2G，内存太小频繁 GC ，影响执行效率。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看进程 GC 信息，1000：每一秒刷新一次")]),s._v("\njstat -gcutil PID "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.42")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.81")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.49")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.87")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("91.64")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.42")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.81")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.49")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.87")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("91.64")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.42")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("97.70")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.49")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.87")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("91.64")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.42")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("97.70")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.49")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.87")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("91.64")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.42")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("97.70")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.49")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.87")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("91.64")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.42")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("97.70")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.49")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.87")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("91.64")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.42")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("97.70")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.49")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.87")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("91.64")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.42")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("98.59")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.49")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.87")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("91.64")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.42")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("98.59")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.49")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.87")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("91.64")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("ul",[n("li",[s._v("YGC：：表示新生代堆内存 GC 次数")]),s._v(" "),n("li",[s._v("YGCT：表示新生代堆内存 GC 消耗的总时间")]),s._v(" "),n("li",[s._v("FGC：FULL GC 发生次数，若发生 FUCC GC，则 Flume 进程会进入暂停状态，FUCC GC 执行完以后 Flume 才会继续工作")]),s._v(" "),n("li",[s._v("GCT：所有类型的 GC 消耗的总时间")])]),s._v(" "),n("div",{staticClass:"language-bash flume-env.sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调整 Flume 进程内存，Xms/Xmx 建议一样大，避免内存交换，内存交换也比较耗性能")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPTS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Xms1024m -Xmx1024m -Dcom.sun.management.jmxremote"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"区分日志文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#区分日志文件"}},[s._v("#")]),s._v(" 区分日志文件")]),s._v(" "),n("p",[s._v("在一台服务器启动多个 Agent 时，建议修改配置区分日志文件。\n在 conf 目录下有 log4j.properties，在这里面指定了日志文件的名称和位置，所有使用 conf 目录下面配置启动的 Agent 产生的日志都会记录到同一个日志文件中。\n拷贝多个 conf 目录，然后修改对应 conf 目录中 log4j.properties 日志的文件名称(可以保证多个 Agent 的日志分别存储)，并且把日志级别调整为 warn(减少垃圾日志的产生)。")]),s._v(" "),n("h2",{attrs:{id:"flume-进程监控"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#flume-进程监控"}},[s._v("#")]),s._v(" Flume 进程监控")]),s._v(" "),n("p",[s._v("针对 Flume 中 Agent 单进程的单点故障问题，实现一个监控告警机制，并且尝试自动重启的思路：")]),s._v(" "),n("ul",[n("li",[s._v("首先需要有一个配置文件，配置文件中指定需要监控的 Agent")]),s._v(" "),n("li",[s._v("通过 Shell 脚本负责读取配置文件，定时挨个检查 Agent 对应的进程还在不在，如果发现对应的进程不在，则记录错误信息，然后告警(发短信或者发邮件) 并尝试重启")])]),s._v(" "),n("div",{staticClass:"language-bash monlist.conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置需要监控的 Agent 及对应的进程启动脚本")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("a1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("startAgent.sh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("div",{staticClass:"language-bash startAgent.sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Agent 启动脚本")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flume_path")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/apache-flume-1.9.0\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Agent 启动")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${flume_path}")]),s._v("/bin/flume-ng agent --name a1 --conf "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${flume_path}")]),s._v("/conf/ --conf-file /data/flume/conf/exec-memory-logger.properties "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("div",{staticClass:"language-bash monlist.sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监控检查某个 Agent 进程是否存在，不存在则重启该进程")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("monlist")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" monlist.conf"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start check Flume Agent ..."')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("item")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${monlist}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置字段分隔符")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OLD_IFS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$IFS")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("IFS")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"="')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把一行内容转成多列[数组]")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("arr")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$item")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取 Agent 唯一标识")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取 Agent 启动脚本")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("script")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time is:"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%Y-%m-%d %H:%M:%S"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('" check "')]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("jps -m "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" $name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" -eq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发短信或者邮件告警")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%Y-%m-%d %H:%M:%S"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$name")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"is none"')]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" -x ./"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${script}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# crontab 定时调度 monlist.sh 监控脚本")]),s._v("\n* * * * * root /bin/bash /data/soft/monlist.sh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);